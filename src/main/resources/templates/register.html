<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Web3 Blog</title>
    <meta name="description" content="Create your Web3 Blog account to join our community and access exclusive content.">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<header>
    <div class="container">
        <div class="header-content">
            <a href="index.html" class="logo">Web3 Blog</a>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html">All Posts</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <a href="login.html" class="btn btn-secondary">Login</a>
            </div>
        </div>
    </div>
</header>

<main>
    <div class="container">
        <div class="form-container">
            <h2 class="text-center mb-4">Create Your Account</h2>

            <div id="alertContainer"></div>

            <form id="registerForm">
                <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" class="form-control">
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" class="form-control">
                </div>

                <div class="form-group">
                    <label for="username">Username *</label>
                    <input type="text" id="username" class="form-control" required minlength="3" maxlength="20">
                    <small>3-20 characters, letters and numbers only</small>
                </div>

                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="password">Password *</label>
                    <input type="password" id="password" class="form-control" required minlength="6" maxlength="40">
                    <small>Minimum 6 characters</small>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password *</label>
                    <input type="password" id="confirmPassword" class="form-control" required>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="termsCheck" required>
                        I agree to the <a href="#" target="_blank">Terms of Service</a> and <a href="#" target="_blank">Privacy Policy</a>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;" id="registerBtn">
                    Create Account
                </button>
            </form>

            <div class="text-center mt-3">
                <p>Already have an account? <a href="login.html">Login here</a></p>
            </div>
        </div>
    </div>
</main>

<footer>
    <div class="container">
        <div class="footer-content">
            <p>&copy; 2025 Web3 Blog. All rights reserved.</p>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Contact</a>
            </div>
        </div>
    </div>
</footer>

<script>
    const API_BASE = 'http://localhost:8080/api';

    // Check if already logged in
    function checkAuth() {
        const token = localStorage.getItem('token');
        if (token) {
            window.location.href = 'index.html';
        }
    }

    // Show alert message
    function showAlert(message, type = 'error') {
        const alertContainer = document.getElementById('alertContainer');
        alertContainer.innerHTML = `
            <div class="alert alert-${type === 'error' ? 'error' : 'success'}">
                ${message}
            </div>
        `;

        // Auto-hide success messages
        if (type === 'success') {
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 3000);
        }
    }

    // Validate form inputs
    function validateForm() {
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const termsChecked = document.getElementById('termsCheck').checked;

        if (!username || username.length < 3 || username.length > 20) {
            showAlert('Username must be 3-20 characters long');
            return false;
        }

        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            showAlert('Username can only contain letters, numbers, and underscores');
            return false;
        }

        if (!email || !isValidEmail(email)) {
            showAlert('Please enter a valid email address');
            return false;
        }

        if (!password || password.length < 6 || password.length > 40) {
            showAlert('Password must be 6-40 characters long');
            return false;
        }

        if (password !== confirmPassword) {
            showAlert('Passwords do not match');
            return false;
        }

        if (!termsChecked) {
            showAlert('Please accept the Terms of Service and Privacy Policy');
            return false;
        }

        return true;
    }

    // Validate email format
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    // Handle registration form submission
    async function handleRegister(event) {
        event.preventDefault();

        if (!validateForm()) {
            return;
        }

        const registerBtn = document.getElementById('registerBtn');
        const formData = {
            firstName: document.getElementById('firstName').value.trim(),
            lastName: document.getElementById('lastName').value.trim(),
            username: document.getElementById('username').value.trim(),
            email: document.getElementById('email').value.trim(),
            password: document.getElementById('password').value,
            role: ['reader'] // Default role
        };

        // Disable button and show loading
        registerBtn.disabled = true;
        registerBtn.textContent = 'Creating Account...';

        try {
            const response = await fetch(`${API_BASE}/auth/signup`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            const data = await response.json();

            if (response.ok) {
                showAlert('Account created successfully! Please login to continue.', 'success');

                // Clear form
                document.getElementById('registerForm').reset();

                // Redirect to login after delay
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);

            } else {
                showAlert(data.message || 'Registration failed. Please try again.');
            }

        } catch (error) {
            console.error('Registration error:', error);
            showAlert('Network error. Please try again.');
        } finally {
            registerBtn.disabled = false;
            registerBtn.textContent = 'Create Account';
        }
    }

    // Real-time password confirmation validation
    function checkPasswordMatch() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const confirmField = document.getElementById('confirmPassword');

        if (confirmPassword && password !== confirmPassword) {
            confirmField.style.borderColor = '#dc3545';
        } else if (confirmPassword) {
            confirmField.style.borderColor = '#28a745';
        } else {
            confirmField.style.borderColor = '#e9ecef';
        }
    }

    // Real-time username validation
    function checkUsername() {
        const username = document.getElementById('username').value;
        const usernameField = document.getElementById('username');

        if (username && (username.length < 3 || !/^[a-zA-Z0-9_]+$/.test(username))) {
            usernameField.style.borderColor = '#dc3545';
        } else if (username.length >= 3) {
            usernameField.style.borderColor = '#28a745';
        } else {
            usernameField.style.borderColor = '#e9ecef';
        }
    }

    // Event listeners
    document.getElementById('registerForm').addEventListener('submit', handleRegister);
    document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);
    document.getElementById('password').addEventListener('input', checkPasswordMatch);
    document.getElementById('username').addEventListener('input', checkUsername);

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        checkAuth();
    });
</script>
</body>
</html>